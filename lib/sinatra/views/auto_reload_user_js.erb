// ==UserScript==
// @name           sinatra_auto_reload_<%= @host.gsub(/[\.\/:]/,'_') %>.user.js
// @namespace      http://shokai.org/
// @description    reload Firefox/Chrome when <%= @host %> was modified
// @include        http://<%=@host%>/*
// @version        0.0.1
// @author         shokai (Sho Hashimoto)
// ==/UserScript==

setInterval(function(){
	var req;
	var self = arguments.callee;
	var req = new XMLHttpRequest;
	req.open("GET", "http://<%=@host%>/sinatra_auto_reload", true);
	req.onload = function(){
	    console.log(req.responseText);
	    (self.old && req.responseText != self.old) && location.reload(true);
	    self.old = req.responseText;
	};
	req.send(null);
    },<%=@interval%>);
